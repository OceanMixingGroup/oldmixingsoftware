% function run_adcpbackup(dataprefix)% function run_marlinbackup(frompath,topath,dataprefix);% This is the top-level script for the back-up computer....%% dataprefix='lab';% this is the prefix of the datafilesfunction run_adcpbackup(frompath,topath,dataprefix,polltime)% function run_adcpbackup(frompath,topath,dataprefix);% This is the top-level script for the back-up computer....% frompath = '\\dirigible\data\eq08\ADCP\';% directory in which the Marlin data is stored...% topath = '\\baltic_data\data\eq08\data\ADCP\';% directory where the Marlin data is backed up to...% this is the prefix of the datafiles% dataprefix='st10';% this how often the daq computer is polled in seconds.% polltime = 3600;% $Revision: 1.3 $ $Date: 2010/05/28 20:03:04 $ $Author: aperlin $	% frompath = '\\gamwy\work\eq08\workhorse150\';% topath = '\\baltic_data\data\eq08\data\workhorse150\';% polltime = 3600;% this approximately how often the daq computer is polled in seconds.% Check that the frompath exists...if ~exist(frompath)  error(['The source directory: ' frompath ' can''t be found.  Check',  ...          'that the machine has been mounted']);end;if ~exist(topath)  error(['The source directory: ' topath ' can''t be found. Create',  ...          ' the directory']);end;while 1  fprintf(1,'Polling for new files in %s\n',frompath );  % first thing is to compare the two directory trees and make sure  % they are identical.  If not, do some copying....  % We can't automate because of the annoying naming convention  % MarlCham files%   fromp = [frompath '/raw/'];%   top = [topath '/raw/'];  fromp = frompath;  top = topath;  fromdir = [fromp dataprefix '*'];  todir = [top dataprefix '*'];  % files are sequential therefore lets strip the sequence numbers  % to compare....  d=dirdiff(fromdir,todir,0,1);  copyall(fromp,top,d);  fprintf(1,'\nWaiting %d seconds to poll again; on file: %d\n',...      polltime,polltime);  disp(datestr(now))%   for j=1:polltime% %     fprintf(1,'-');%     pause(1); %   end;%   fprintf('\n');end;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%function copyall(fromdir,todir,names)  for i=1:length(names);    from = [fromdir '/' names{i}];    to = [todir '/'];    fprintf(1,'Copying %s to %s\n',from,to);    [status,msg]=copyfile(from,to);    if ~status      error(msg);    end;  end;  